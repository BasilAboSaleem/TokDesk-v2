<aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme shadow-sm">
  <!-- Brand & Toggle -->
  <div class="app-brand demo d-flex align-items-center justify-content-between px-3 py-2">
    <a href="/dashboard" class="app-brand-link d-flex align-items-center">
      <span class="app-brand-logo demo">
        <!-- SVG Logo -->
      </span>
      <span class="app-brand-text demo menu-text fw-bolder ms-2">TokDesk</span>
    </a>
   <div class="sidebar-toggle-container text-center py-2">
    <button class="btn btn-sm btn-outline-secondary" id="sidebar-toggle">
      <i class="bx bx-chevron-left"></i>
    </button>
  </div>
  </div>

  <div class="menu-inner-shadow"></div>

  <ul class="menu-inner py-1">
    <!-- Dashboard لجميع المستخدمين -->
    <li class="menu-item <%= (page === 'dashboard') ? 'active' : '' %>">
      <a href="/dashboard" class="menu-link">
        <i class="menu-icon tf-icons bx bx-home-circle"></i>
        <div class="menu-text">Dashboard</div>
      </a>
    </li>

    <!-- Administration -->
    <% if (user && [ROLES.SUPER_ADMIN, ROLES.ADMIN].includes(user.role)) { %>
      <li class="menu-header small text-uppercase"><span class="menu-header-text">Administration</span></li>
      <li class="menu-item"><a href="/dashboard/companies" class="menu-link"><i class="menu-icon tf-icons bx bx-building"></i><div class="menu-text">Companies</div></a></li>
      <li class="menu-item"><a href="/dashboard/users" class="menu-link"><i class="menu-icon tf-icons bx bx-user"></i><div class="menu-text">Users</div></a></li>
      <li class="menu-item"><a href="/dashboard/departments" class="menu-link"><i class="menu-icon tf-icons bx bx-grid"></i><div class="menu-text">Departments</div></a></li>
      <li class="menu-item"><a href="/dashboard/invitations" class="menu-link"><i class="menu-icon tf-icons bx bx-envelope"></i><div class="menu-text">Invitations</div></a></li>
    <% } %>

    <!-- Management -->
    <% if (user && [ROLES.HEAD_OF_DEPARTMENT, ROLES.PROJECT_MANAGER].includes(user.role)) { %>
      <li class="menu-header small text-uppercase"><span class="menu-header-text">Management</span></li>
      <li class="menu-item"><a href="/dashboard/conversations" class="menu-link"><i class="menu-icon tf-icons bx bx-chat"></i><div class="menu-text">Conversations</div></a></li>
      <li class="menu-item"><a href="/dashboard/messages" class="menu-link"><i class="menu-icon tf-icons bx bx-message"></i><div class="menu-text">Messages</div></a></li>
    <% } %>

    <!-- Employee -->
    <% if (user && user.role === ROLES.EMPLOYEE) { %>
      <li class="menu-header small text-uppercase"><span class="menu-header-text">Employee</span></li>
      <li class="menu-item"><a href="/dashboard/tasks" class="menu-link"><i class="menu-icon tf-icons bx bx-task"></i><div class="menu-text">Tasks</div></a></li>
    <% } %>

    <!-- Guest -->
    <% if (user && user.role === ROLES.GUEST) { %>
      <li class="menu-item"><a href="/dashboard/guest-info" class="menu-link"><i class="menu-icon tf-icons bx bx-info-circle"></i><div class="menu-text">Guest Info</div></a></li>
    <% } %>

    <!-- Announcements لجميع المستخدمين -->
    <li class="menu-item"><a href="/dashboard/announcements" class="menu-link"><i class="menu-icon tf-icons bx bx-megaphone"></i><div class="menu-text">Announcements</div></a></li>

    <!-- Account -->
    <li class="menu-header small text-uppercase"><span class="menu-header-text">Account</span></li>
    <li class="menu-item"><a href="/dashboard/profile" class="menu-link"><i class="menu-icon tf-icons bx bx-user-circle"></i><div class="menu-text">Profile</div></a></li>
    <li class="menu-item"><a href="/auth/logout" class="menu-link"><i class="menu-icon tf-icons bx bx-power-off"></i><div class="menu-text">Logout</div></a></li>
  </ul>
</aside>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sidebar = document.getElementById('layout-menu');
  const toggleBtn = document.getElementById('sidebar-toggle');
  
  toggleBtn.addEventListener('click', function() {
    sidebar.classList.toggle('menu-collapsed');
    
    const icon = toggleBtn.querySelector('i');
    if (sidebar.classList.contains('menu-collapsed')) {
      icon.className = 'bx bx-chevron-right';
    } else {
      icon.className = 'bx bx-chevron-left';
    }
  });
});
</script>

<style>
/* Sidebar مصغر */
.layout-menu.menu-collapsed {
  width: 70px !important;
  transition: width 0.3s ease;
}

/* Sidebar مخفي */
.layout-menu.menu-hidden {
  width: 0 !important;
  transition: width 0.3s ease;
}

/* المحتوى الرئيسي عند sidebar مصغر */
.layout-menu.menu-collapsed ~ .layout-page {
  margin-left: -70px !important;
justify-content: center !important;
  width: 100% !important; /* هذا الأهم */
  transition: margin-left 0.3s;
}

/* المحتوى الرئيسي عند sidebar مخفي */
.layout-menu.menu-hidden ~ .layout-page {
  margin-left: 0 !important; /* يتحرك ناحية اليسار بالكامل */
  width: 100% !important;
  transition: margin-left 0.3s;
}

/* نصوص مخفية عند sidebar مصغر أو مخفي */
.layout-menu.menu-collapsed .menu-text,
.layout-menu.menu-collapsed .app-brand-text,
.layout-menu.menu-collapsed .menu-header,
.layout-menu.menu-hidden .menu-text,
.layout-menu.menu-hidden .app-brand-text,
.layout-menu.menu-hidden .menu-header {
  display: none !important;
}

/* الآيقونات */
.layout-menu.menu-collapsed .menu-icon,
.layout-menu.menu-hidden .menu-icon {
  margin: 0 auto !important;
}
/* إصلاح Hover على الأيقونات */
.layout-menu.menu-collapsed .menu-item:hover .menu-icon,
.layout-menu.menu-hidden .menu-item:hover .menu-icon {
  display: flex !important;       /* تأكد من ظهور الأيقونات */
  justify-content: center !important;
  align-items: center !important;
  color: var(--bs-primary);       /* أي لون hover تحبه */
  transform: scale(1.1);          /* تأثير تكبير خفيف */
  transition: transform 0.2s, color 0.2s;
}

/* إزالة أي تأثير قد يخفي الأيقونات عند Hover */
.layout-menu.menu-collapsed .menu-item:hover .menu-text,
.layout-menu.menu-hidden .menu-item:hover .menu-text {
  display: none !important;
}
/* ترتيب links */
.layout-menu.menu-collapsed .menu-link,
.layout-menu.menu-hidden .menu-link {
  justify-content: center !important;
}

/* transition للمحتوى */
.content-wrapper,
.container-xxl,
.layout-page {
  transition: margin-left 0.3s;
}
@media (max-width: 1199px) {
  .layout-menu.menu-collapsed ~ .layout-page,
  .layout-menu.menu-hidden ~ .layout-page {
    margin-left: 0 !important; 
  }}
</style>