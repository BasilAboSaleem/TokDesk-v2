<!doctype html>
<html lang="<%= locale %>" dir="<%= dir %>">

<%- include('../../../partials/head.ejs') %>

<body class="">
  <div class="bmd-layout-container bmd-drawer-f-l avam-container animated bmd-drawer-in">

    <!-- Header -->
    <%- include('../../../partials/header.ejs') %>

    <!-- Sidebar -->
    <div id="dw-s1" class="bmd-layout-drawer bg-faded">
      <%- include('../../../partials/sidebar.ejs') %>
    </div>

    <!-- Main Content -->
    <main class="bmd-layout-content">
      <div class="container-fluid my-4">

        <!-- Title + Breadcrumb -->
        <div class="row m-1 pb-4 mb-3">
          <div class="col-12 p-2">
            <div class="page-header breadcrumb-header">
              <div class="row align-items-end">
                <div class="col-lg-8">
                  <div class="page-header-title text-left-rtl">
                    <div class="d-inline">
                      <h3 class="lite-text"><%= t('dashboard:superAdmin.companies.company_details_title') %></h3>
                      <span class="lite-text text-gray"><%= t('dashboard:superAdmin.companies.company_details_subtitle') %></span>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4">
                  <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item">
                      <a href="/superadmin/dashboard"><i class="fas fa-home"></i></a>
                    </li>
                    <li class="breadcrumb-item">
                      <a href="/superadmin/companies"><%= t('dashboard:superAdmin.companies.breadcrumb_companies') %></a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                      <%= t('dashboard:superAdmin.companies.company_details_title') %>
                    </li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="row m-1 mb-4">
          <div class="col-12 d-flex gap-2 flex-wrap align-items-center">

            <!-- Back Button -->
            <a href="/superadmin/companies" class="btn btn-secondary px-4 py-2 rounded-pill">
              <i class="bx bx-arrow-back"></i> <%= t('dashboard:back_to_list') %>
            </a>

            <!-- Approve -->
            <form action="/superadmin/companies/<%= company._id %>/approve" method="POST" class="m-0">
              <button type="submit" class="btn btn-success px-4 py-2 rounded-pill">
                <i class="bx bx-check"></i> <%= t('dashboard:superAdmin.companies.approve') %>
              </button>
            </form>

            <!-- Reject -->
            <button class="btn btn-danger px-4 py-2 rounded-pill"
              data-bs-toggle="modal"
              data-bs-target="#rejectCompanyModal">
              <i class="bx bx-x"></i> <%= t('dashboard:superAdmin.companies.reject') %>
            </button>

          </div>
        </div>

        <!-- Company Details Card -->
        <div class="row m-1 mb-4">
          <div class="col-12 p-2">
            <div class="card shade shadow-sm border-0">
              <div class="card-header fw-bold d-flex align-items-center gap-2">
                <i class="bx bx-building-house"></i> <%= t('dashboard:superAdmin.companies.company_info') %>
              </div>
              <div class="card-body">

                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.table_company_name') %>:</div>
                  <div class="col-md-9"><%= company.name %></div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.table_email') %>:</div>
                  <div class="col-md-9"><%= company.email %></div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.phone') %>:</div>
                  <div class="col-md-9"><%= company.phone %></div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.subdomain') %>:</div>
                  <div class="col-md-9"><%= company.subdomain %>.tokdesk.com</div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.created_at') %>:</div>
                  <div class="col-md-9"><%= company.createdAt.toLocaleDateString(locale) %></div>
                </div>

                <% if (company.logo) { %>
                <div class="row mb-3">
                  <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.logo') %>:</div>
                  <div class="col-md-9">
                    <img src="<%= company.logo %>" class="img-thumbnail" style="max-width: 140px;">
                  </div>
                </div>
                <% } %>

              </div>
            </div>
          </div>
        </div>

        <!-- Admin Details Card -->
        <div class="row m-1 mb-4">
          <div class="col-12 p-2">
            <div class="card shade shadow-sm border-0">
              <div class="card-header fw-bold d-flex align-items-center gap-2">
                <i class="bx bx-user"></i> <%= t('dashboard:superAdmin.companies.admin_info') %>
              </div>
              <div class="card-body">

                <% if (admins && admins.length > 0) { %>
                  <% admins.forEach((admin, index) => { %>
                    <div class="mb-4 border-bottom pb-3">
                      <h6 class="fw-bold"><%= t('dashboard:superAdmin.companies.admin') %> <%= index + 1 %></h6>

                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.admin_fullname') %>:</div>
                        <div class="col-md-9"><%= admin.name %></div>
                      </div>

                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.table_email') %>:</div>
                        <div class="col-md-9"><%= admin.email %></div>
                      </div>

                      <% if (admin.profileImage) { %>
                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.avatar') %>:</div>
                        <div class="col-md-9">
                          <img src="<%= admin.profileImage %>" class="rounded-circle border" style="width: 80px; height: 80px; object-fit: cover;">
                        </div>
                      </div>
                      <% } %>

                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.role') %>:</div>
                        <div class="col-md-9"><%= adminRelations[index].role %></div>
                      </div>

                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.status') %>:</div>
                        <div class="col-md-9 text-capitalize"><%= admin.status %></div>
                      </div>

                      <div class="row mb-2">
                        <div class="col-md-3 fw-bold"><%= t('dashboard:superAdmin.companies.created_at') %>:</div>
                        <div class="col-md-9"><%= admin.createdAt.toLocaleDateString(locale) %></div>
                      </div>

                    </div>
                  <% }) %>
                <% } else { %>
                  <div class="text-muted"><%= t('dashboard:superAdmin.companies.no_admin') %></div>
                <% } %>

              </div>
            </div>
          </div>
        </div>

      </div>
    </main>

  </div>

  <!-- Reject Modal -->
  <div class="modal fade" id="rejectCompanyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <form action="/superadmin/companies/<%= company._id %>/reject" method="POST">

          <div class="modal-header">
            <h5 class="modal-title fw-bold"><%= t('dashboard:superAdmin.companies.reject_modal_title') %></h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body">
            <label class="form-label fw-bold"><%= t('dashboard:superAdmin.companies.reject_modal_reason') %></label>
            <textarea name="reason" class="form-control" required rows="4"></textarea>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary px-4 py-2" data-bs-dismiss="modal"><%= t('dashboard:cancel') %></button>
            <button class="btn btn-danger px-4 py-2"><%= t('dashboard:superAdmin.companies.reject') %></button>
          </div>

        </form>

      </div>
    </div>
  </div>

  <%- include('../../../partials/scripts.ejs') %>
</body>
</html>
